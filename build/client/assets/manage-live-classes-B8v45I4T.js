import{y as se,w as te,x as ae,r as _,n as e,F as $}from"./components-CK9cG6NQ.js";import{t as z}from"./index-C8LQY8mX.js";import{C as ie,a as le,b as re,c as ne,d as ce}from"./card-CA1SrpzI.js";import{I as N}from"./input-BXDRLaNk.js";import{L as n}from"./label-DqiQ_QAn.js";import{B as w}from"./button-8oCJS-za.js";import{D as oe,f as de,a as he,b as me,c as ue,d as xe}from"./dialog-B7fq2mTW.js";import{S as c,a as o,b as d,c as h,d as i}from"./select-DaRfL70x.js";import{T as je,a as pe,b as k,c as x,d as ge,e as m}from"./table-CRJQl8tI.js";import{B as ve}from"./badge-CcGIdf3j.js";import{P as _e}from"./plus-BQN0Gcjy.js";import{S as Se,a as fe,T as Ne,E as we}from"./trash-2-DbvqRWWT.js";import{C as M,a as be}from"./clock-XivtrA7v.js";import{P as ye}from"./play-CXAmcsiu.js";import"./index-B5_uNIGj.js";import"./index-DPB-uZjz.js";import"./index-Z0unZZUp.js";import"./index-B4ME6Vf2.js";import"./x-DGchQd-t.js";import"./createLucideIcon-B7_wo53H.js";import"./index-DHMePj9W.js";import"./index-USjovnYi.js";import"./index-B4BDNWcH.js";const Te=p=>{const g={upcoming:{color:"bg-blue-100 text-blue-800",icon:M,text:"Upcoming"},live:{color:"bg-red-100 text-red-800",icon:ye,text:"Live"},completed:{color:"bg-green-100 text-green-800",icon:be,text:"Completed"},cancelled:{color:"bg-gray-100 text-gray-800",icon:M,text:"Cancelled"}},r=g[p]||g.upcoming,S=r.icon;return e.jsxs(ve,{className:`${r.color} flex items-center gap-1`,children:[e.jsx(S,{className:"h-3 w-3"}),r.text]})},Ce=(p,g)=>{if(!p)return"upcoming";const r=new Date,S=new Date(p),v=g?new Date(g):null;return r<S?"upcoming":v&&r>v?"completed":r>=S&&(!v||r<=v)?"live":"upcoming"};function ss(){var E,q,B;const{classes:p,subjects:g,teachers:r,liveClasses:S,schools:v,user:j}=se(),u=te(),V=ae().state==="submitting",[W,b]=_.useState(!1),[y,F]=_.useState("create"),[t,C]=_.useState(null),[Le,ke]=_.useState(null),[A,D]=_.useState("subject_specific"),[a,f]=_.useState({search:"",status:"all",school:"all",teacher:"all",class:"all",date:"all"});_.useEffect(()=>{u!=null&&u.success?(z.success(u.message),b(!1),C(null)):(u==null?void 0:u.success)===!1&&z.error(u.message)},[u]);const T=S.map(s=>({...s,status:Ce(s.start_time,s.end_time)})).filter(s=>{var O,I,U,P;const l=!a.search||s.title.toLowerCase().includes(a.search.toLowerCase())||((O=s.topic_name)==null?void 0:O.toLowerCase().includes(a.search.toLowerCase()))||((I=s.teacher_name)==null?void 0:I.toLowerCase().includes(a.search.toLowerCase())),L=a.status==="all"||s.status===a.status,G=a.school==="all"||s.school_ids&&s.school_ids.includes(a.school),J=a.teacher==="all"||((U=s.teacher_id)==null?void 0:U.toString())===a.teacher,K=a.class==="all"||((P=s.class_id)==null?void 0:P.toString())===a.class,Q=a.date==="all"||(()=>{if(!s.start_time)return a.date==="all";const H=new Date(s.start_time).toDateString(),X=new Date().toDateString(),Z=new Date(Date.now()+864e5).toDateString();switch(a.date){case"today":return H===X;case"tomorrow":return H===Z;case"this_week":{const ee=new Date(Date.now()+6048e5);return new Date(s.start_time)<=ee}default:return!0}})();return l&&L&&G&&J&&K&&Q}),Y=()=>{F("create"),C(null),D("subject_specific"),b(!0)},R=s=>{F("update"),C(s),D(s.session_type),b(!0)};return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs(ie,{children:[e.jsxs(le,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(re,{className:"text-2xl font-bold",children:"Manage Live Classes"}),e.jsx(ne,{children:"Efficiently manage YouTube Live lecture sessions with automatic status updates"})]}),e.jsxs(oe,{open:W,onOpenChange:b,children:[e.jsx(de,{asChild:!0,children:e.jsxs(w,{onClick:Y,children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Create Live Class"]})}),e.jsxs(he,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(me,{children:[e.jsx(ue,{children:y==="create"?"Create New Live Class":"Edit Live Class"}),e.jsx(xe,{children:y==="create"?"Create a new live class session. Start Time and End Time are mandatory.":"Update the live class information. Start Time and End Time are mandatory."})]}),e.jsxs($,{method:"post",children:[e.jsx("input",{type:"hidden",name:"intent",value:y==="create"?"create":"update"}),y==="update"&&e.jsx("input",{type:"hidden",name:"id",value:t==null?void 0:t.id}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"title",children:"Session Title *"}),e.jsx(N,{id:"title",name:"title",placeholder:"e.g., Mathematics Live Session",required:!0,defaultValue:(t==null?void 0:t.title)||""})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"youtube_live_link",children:"YouTube Live Link *"}),e.jsx(N,{id:"youtube_live_link",name:"youtube_live_link",type:"url",placeholder:"https://www.youtube.com/watch?v=...",required:!0,defaultValue:(t==null?void 0:t.youtube_live_link)||""})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"session_type",children:"Session Type *"}),e.jsxs(c,{name:"session_type",value:A,onValueChange:D,required:!0,children:[e.jsx(o,{children:e.jsx(d,{placeholder:"Select session type"})}),e.jsxs(h,{children:[e.jsx(i,{value:"subject_specific",children:"Subject-Specific Session"}),e.jsx(i,{value:"other_topic",children:"Other Topic Session"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"topic_name",children:"Topic Name *"}),e.jsx(N,{id:"topic_name",name:"topic_name",placeholder:"e.g., Algebra Basics, Career Guidance",required:!0,defaultValue:(t==null?void 0:t.topic_name)||""})]}),A==="subject_specific"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"subject_id",children:"Subject"}),e.jsxs(c,{name:"subject_id",defaultValue:(E=t==null?void 0:t.subject_id)==null?void 0:E.toString(),children:[e.jsx(o,{children:e.jsx(d,{placeholder:"Select subject"})}),e.jsx(h,{children:g.map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"class_id",children:"Class *"}),e.jsxs(c,{name:"class_id",required:!0,defaultValue:(q=t==null?void 0:t.class_id)==null?void 0:q.toString(),children:[e.jsx(o,{children:e.jsx(d,{placeholder:"Select class"})}),e.jsx(h,{children:p.map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))})]})]}),j.role_name!=="teacher"&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"teacher_id",children:"Teacher *"}),e.jsxs(c,{name:"teacher_id",required:!0,defaultValue:(B=t==null?void 0:t.teacher_id)==null?void 0:B.toString(),children:[e.jsx(o,{children:e.jsx(d,{placeholder:"Select teacher"})}),e.jsx(h,{children:r.map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))})]})]}),(j.role_name==="super_admin"||j.role_name==="school_admin")&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"school_id",children:"School *"}),e.jsxs(c,{name:"school_id",required:!0,children:[e.jsx(o,{children:e.jsx(d,{placeholder:"Select school"})}),e.jsxs(h,{children:[j.role_name==="super_admin"&&e.jsx(i,{value:"all",children:"All Schools"}),v.map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"start_time",children:"Start Time *"}),e.jsx(N,{id:"start_time",name:"start_time",type:"datetime-local",required:!0,defaultValue:t!=null&&t.start_time?new Date(t.start_time).toISOString().slice(0,16):""})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"end_time",children:"End Time *"}),e.jsx(N,{id:"end_time",name:"end_time",type:"datetime-local",required:!0,defaultValue:t!=null&&t.end_time?new Date(t.end_time).toISOString().slice(0,16):""})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(w,{type:"submit",disabled:V,children:V?"Saving...":y==="create"?"Create Class":"Update Class"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(N,{placeholder:"Search classes...",value:a.search,onChange:s=>f(l=>({...l,search:s.target.value})),className:"pl-8"})]}),e.jsxs(c,{value:a.status,onValueChange:s=>f(l=>({...l,status:s})),children:[e.jsx(o,{children:e.jsx(d,{placeholder:"Status"})}),e.jsxs(h,{children:[e.jsx(i,{value:"all",children:"All Status"}),e.jsx(i,{value:"upcoming",children:"Upcoming"}),e.jsx(i,{value:"live",children:"Live"}),e.jsx(i,{value:"completed",children:"Completed"})]})]}),j.role_name==="super_admin"&&e.jsxs(c,{value:a.school,onValueChange:s=>f(l=>({...l,school:s})),children:[e.jsx(o,{children:e.jsx(d,{placeholder:"School"})}),e.jsxs(h,{children:[e.jsx(i,{value:"all",children:"All Schools"}),v.map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))]})]}),e.jsxs(c,{value:a.teacher,onValueChange:s=>f(l=>({...l,teacher:s})),children:[e.jsx(o,{children:e.jsx(d,{placeholder:"Teacher"})}),e.jsxs(h,{children:[e.jsx(i,{value:"all",children:"All Teachers"}),r.map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))]})]}),e.jsxs(c,{value:a.class,onValueChange:s=>f(l=>({...l,class:s})),children:[e.jsx(o,{children:e.jsx(d,{placeholder:"Class"})}),e.jsxs(h,{children:[e.jsx(i,{value:"all",children:"All Classes"}),p.map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))]})]}),e.jsxs(c,{value:a.date,onValueChange:s=>f(l=>({...l,date:s})),children:[e.jsx(o,{children:e.jsx(d,{placeholder:"Date"})}),e.jsxs(h,{children:[e.jsx(i,{value:"all",children:"All Dates"}),e.jsx(i,{value:"today",children:"Today"}),e.jsx(i,{value:"tomorrow",children:"Tomorrow"}),e.jsx(i,{value:"this_week",children:"This Week"})]})]})]})]}),e.jsx(ce,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(je,{children:[e.jsx(pe,{children:e.jsxs(k,{children:[e.jsx(x,{className:"text-center",children:"Title"}),e.jsx(x,{className:"text-center",children:"Topic"}),e.jsx(x,{className:"text-center",children:"Class"}),e.jsx(x,{className:"text-center",children:"Teacher"}),j.role_name==="super_admin"&&e.jsx(x,{className:"text-center",children:"Schools"}),e.jsx(x,{className:"text-center",children:"Start Time"}),e.jsx(x,{className:"text-center",children:"End Time"}),e.jsx(x,{className:"text-center",children:"Status"}),e.jsx(x,{className:"text-center",children:"Actions"})]})}),e.jsx(ge,{children:T!=null&&T.length?T.map(s=>e.jsxs(k,{children:[e.jsx(m,{className:"text-center font-medium",children:s.title}),e.jsx(m,{className:"text-center",children:s.topic_name}),e.jsx(m,{className:"text-center",children:s.class_name}),e.jsx(m,{className:"text-center",children:s.teacher_name}),j.role_name==="super_admin"&&e.jsx(m,{className:"text-center",children:s.school_count>1?`All Schools (${s.school_count})`:s.school_names}),e.jsx(m,{className:"text-center",children:s.start_time?new Date(s.start_time).toLocaleString():"Not set"}),e.jsx(m,{className:"text-center",children:s.end_time?new Date(s.end_time).toLocaleString():"Not set"}),e.jsx(m,{className:"text-center",children:Te(s.status)}),e.jsx(m,{className:"text-center",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsx(w,{variant:"outline",size:"sm",onClick:()=>R(s),children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsxs($,{method:"post",style:{display:"inline"},children:[e.jsx("input",{type:"hidden",name:"intent",value:"delete"}),e.jsx("input",{type:"hidden",name:"id",value:s.id}),e.jsx(w,{type:"submit",variant:"outline",size:"sm",onClick:l=>{const L=s.is_all_schools?`Are you sure you want to delete "${s.title}" from all schools? This action cannot be undone.`:`Are you sure you want to delete "${s.title}"? This action cannot be undone.`;confirm(L)||l.preventDefault()},children:e.jsx(Ne,{className:"h-4 w-4"})})]}),e.jsx(w,{variant:"outline",size:"sm",onClick:()=>window.open(s.youtube_live_link,"_blank"),title:"Open YouTube Live",children:e.jsx(we,{className:"h-4 w-4"})})]})})]},s.id)):e.jsx(k,{children:e.jsx(m,{colSpan:j.role_name==="super_admin"?9:8,className:"h-24 text-center",children:"No live classes found matching your filters."})})})]})})})]})})}export{ss as default};
