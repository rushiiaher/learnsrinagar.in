import{y as re,w as ce,C as oe,D as de,r as t,n as e}from"./components-CK9cG6NQ.js";import{t as T}from"./index-C8LQY8mX.js";import{B as l}from"./button-8oCJS-za.js";import{I as j}from"./input-BXDRLaNk.js";import{D as y,a as A,b as _,c as F,d as P,e as k}from"./dialog-B7fq2mTW.js";import{S as E,a as R,b as I,c as z,d as O}from"./select-DaRfL70x.js";import{u as me,f as M,A as he,a as ue,b as pe,c as xe,d as ge,e as je,g as fe,h as be,i as De,j as ve}from"./index-BpyxCKkI.js";import{T as Se,a as Ce,b as f,c as Ne,d as we,e as B}from"./table-CRJQl8tI.js";import{B as Te}from"./badge-CcGIdf3j.js";import{P as q}from"./plus-BQN0Gcjy.js";import{P as ye}from"./pencil-DYF0NOrj.js";import{T as Ae}from"./trash-sprkVQyV.js";import"./index-DPB-uZjz.js";import"./index-Z0unZZUp.js";import"./index-B5_uNIGj.js";import"./index-B4ME6Vf2.js";import"./x-DGchQd-t.js";import"./createLucideIcon-B7_wo53H.js";import"./index-DHMePj9W.js";import"./index-USjovnYi.js";import"./index-B4BDNWcH.js";function Xe(){var w;const{teachers:H,classes:V,subjects:b,teacherAssignments:K}=re(),o=ce(),h=oe();de();const[L,d]=t.useState(!1),[i,D]=t.useState("create"),[n,v]=t.useState(null),[U,g]=t.useState(!1),[u,G]=t.useState(null),[J,p]=t.useState(!1),[Q,W]=t.useState(null),[r,S]=t.useState(""),[X,C]=t.useState([]);t.useEffect(()=>{o&&(o.success?(T.success(o.message),d(!1),p(!1)):T.error(o.message))},[o]),t.useEffect(()=>{if(r){const s=b.filter(a=>a.class_id&&a.class_id.toString()===r);C(s)}else C([])},[r,b]);const Y=s=>{S(s);const a=document.getElementById("assignSubjectForm");if(a){const m=a.elements.subject_id;m&&(m.value="")}},Z=()=>{D("create"),v(null),d(!0)},$=s=>{D("update"),v(s),d(!0)},ee=s=>{G(s),g(!0)},se=()=>{const s=new FormData;s.append("_action","delete"),s.append("id",u.id),h(s,{method:"post"}),g(!1)},ae=s=>{W(s),S(""),p(!0)},te=s=>{const a=new FormData;a.append("_action","remove_assignment"),a.append("assignment_id",s),h(a,{method:"post"})},le=s=>{s.preventDefault();const a=new FormData(s.currentTarget);a.append("_action",i),i==="update"&&n&&a.append("id",n.id),h(a,{method:"post"})},ie=s=>{s.preventDefault();const a=new FormData(s.currentTarget);a.append("_action","assign_subject"),a.append("teacher_id",Q),a.append("class_id",r),h(a,{method:"post"})},N=[{accessorKey:"name",header:"Name",cell:({row:s})=>e.jsx("div",{className:"text-center",children:s.original.name})},{accessorKey:"email",header:"Email",cell:({row:s})=>e.jsx("div",{className:"text-center",children:s.original.email})},{id:"subjects",header:"Assigned Subjects",cell:({row:s})=>{const a=s.original.id,m=K[a]||[];return e.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[m.length>0?m.map(x=>e.jsxs(Te,{variant:"secondary",className:"flex items-center gap-1",children:[x.subject_name," (Class ",x.class_name,")",e.jsx("button",{className:"ml-1 text-xs hover:text-destructive",onClick:()=>te(x.id),children:"Ã—"})]},x.id)):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No subjects assigned"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>ae(a),className:"mt-1 h-6",children:e.jsx(q,{className:"h-3 w-3"})})]})}},{accessorKey:"created_at",header:"Created At",cell:({row:s})=>e.jsx("div",{className:"text-center",children:new Date(s.original.created_at).toLocaleDateString()})},{id:"actions",header:"Actions",cell:({row:s})=>e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>$(s.original),children:e.jsx(ye,{className:"size-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>ee(s.original),children:e.jsx(Ae,{className:"size-4"})})]})}],c=me({data:H,columns:N,getCoreRowModel:ve(),getPaginationRowModel:De(),initialState:{pagination:{pageSize:10}}}),ne=i==="create"?"Create New Teacher":"Edit Teacher";return e.jsxs("div",{className:"container mx-auto pb-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("span",{className:"ml-2 pt-2 text-xl font-semibold",children:"Manage Teachers"}),e.jsxs(l,{onClick:Z,children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Add Teacher"})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Se,{children:[e.jsx(Ce,{children:c.getHeaderGroups().map(s=>e.jsx(f,{children:s.headers.map(a=>e.jsx(Ne,{className:"text-center",children:a.isPlaceholder?null:M(a.column.columnDef.header,a.getContext())},a.id))},s.id))}),e.jsx(we,{children:(w=c.getRowModel().rows)!=null&&w.length?c.getRowModel().rows.map(s=>e.jsx(f,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(a=>e.jsx(B,{className:"text-center",children:M(a.column.columnDef.cell,a.getContext())},a.id))},s.id)):e.jsx(f,{children:e.jsx(B,{colSpan:N.length,className:"h-24 text-center",children:"No teachers found."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>c.previousPage(),disabled:!c.getCanPreviousPage(),children:"Previous"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>c.nextPage(),disabled:!c.getCanNextPage(),children:"Next"})]}),e.jsx(y,{open:L,onOpenChange:d,children:e.jsxs(A,{children:[e.jsxs(_,{children:[e.jsx(F,{children:ne}),e.jsx(P,{children:i==="create"?"Fill out the form below to create a new teacher account.":"Update the teacher information."})]}),e.jsxs("form",{onSubmit:le,children:[e.jsxs("div",{className:"grid gap-4 pb-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"name",children:"Full Name"}),e.jsx(j,{id:"name",name:"name",placeholder:"Enter full name",defaultValue:(n==null?void 0:n.name)||"",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx(j,{id:"email",name:"email",type:"email",placeholder:"Enter email address",defaultValue:(n==null?void 0:n.email)||"",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"password",children:i==="create"?"Password":"New Password (leave blank to keep current)"}),e.jsx(j,{id:"password",name:"password",type:"password",placeholder:i==="create"?"Enter password":"Enter new password or leave blank",required:i==="create"})]})]}),e.jsxs(k,{children:[e.jsx(l,{variant:"outline",onClick:()=>d(!1),type:"button",children:"Cancel"}),e.jsx(l,{type:"submit",children:i==="create"?"Create Teacher":"Update Teacher"})]})]})]})}),e.jsx(he,{open:U,onOpenChange:g,children:e.jsxs(ue,{children:[e.jsxs(pe,{className:"text-center",children:[e.jsx(xe,{children:"Delete Teacher"}),e.jsxs(ge,{children:['Are you sure you want to delete teacher "',u==null?void 0:u.name,'"? This will also remove all subject assignments for this teacher. This action cannot be undone.']})]}),e.jsxs(je,{className:"flex justify-end",children:[e.jsx(fe,{children:"Cancel"}),e.jsx(be,{onClick:se,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(y,{open:J,onOpenChange:p,children:e.jsxs(A,{children:[e.jsxs(_,{children:[e.jsx(F,{children:"Assign Subject"}),e.jsx(P,{children:"Select a subject to assign to this teacher."})]}),e.jsxs("form",{id:"assignSubjectForm",onSubmit:ie,children:[e.jsxs("div",{className:"grid gap-4 pb-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"class_id",children:"Class"}),e.jsxs(E,{value:r,onValueChange:Y,required:!0,children:[e.jsx(R,{className:"w-full",children:e.jsx(I,{placeholder:"Select a class"})}),e.jsx(z,{children:V.map(s=>e.jsxs(O,{value:s.id.toString(),children:["Class ",s.name]},s.id))})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"subject_id",children:"Subject"}),e.jsxs(E,{name:"subject_id",disabled:!r,required:!0,children:[e.jsx(R,{className:"w-full",children:e.jsx(I,{placeholder:r?"Select a subject":"Select a class first"})}),e.jsx(z,{children:X.map(s=>e.jsx(O,{value:s.id.toString(),children:s.name},s.id))})]})]})]}),e.jsxs(k,{children:[e.jsx(l,{variant:"outline",onClick:()=>p(!1),type:"button",children:"Cancel"}),e.jsx(l,{type:"submit",disabled:!r,children:"Assign Subject"})]})]})]})})]})}export{Xe as default};
