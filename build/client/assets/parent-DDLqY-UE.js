import{y as W,w as X,C as Y,D as Z,r as i,n as e}from"./components-CK9cG6NQ.js";import{t as v}from"./index-C8LQY8mX.js";import{B as s}from"./button-8oCJS-za.js";import{I as x}from"./input-BXDRLaNk.js";import{D as N,a as C,b as w,c as S,d as k,e as P}from"./dialog-B7fq2mTW.js";import{S as $,a as ee,b as ae,c as te,d as se}from"./select-DaRfL70x.js";import{u as ne,f as y,A as le,a as ie,b as re,c as oe,d as de,e as ce,g as me,h as pe,i as ue,j as he}from"./index-BpyxCKkI.js";import{T as xe,a as ge,b as g,c as je,d as fe,e as T}from"./table-CRJQl8tI.js";import{B as De}from"./badge-CcGIdf3j.js";import{P as A}from"./plus-BQN0Gcjy.js";import{P as be}from"./pencil-DYF0NOrj.js";import{T as ve}from"./trash-sprkVQyV.js";import"./index-DPB-uZjz.js";import"./index-Z0unZZUp.js";import"./index-B5_uNIGj.js";import"./index-B4ME6Vf2.js";import"./x-DGchQd-t.js";import"./createLucideIcon-B7_wo53H.js";import"./index-DHMePj9W.js";import"./index-USjovnYi.js";import"./index-B4BDNWcH.js";function Ve(){const{parents:_,students:F,parentStudentLinks:E}=W(),o=X(),c=Y();Z();const[R,d]=i.useState(!1),[n,j]=i.useState("create"),[l,f]=i.useState(null),[L,u]=i.useState(!1),[m,z]=i.useState(null),[O,p]=i.useState(!1),[M,B]=i.useState(null);i.useEffect(()=>{o&&(o.success?(v.success(o.message),d(!1),p(!1)):v.error(o.message))},[o]);const H=()=>{j("create"),f(null),d(!0)},I=a=>{j("update"),f(a),d(!0)},q=a=>{z(a),u(!0)},V=()=>{const a=new FormData;a.append("_action","delete"),a.append("id",m.id),c(a,{method:"post"}),u(!1)},K=a=>{B(a),p(!0)},U=a=>{const t=new FormData;t.append("_action","remove_link"),t.append("link_id",a),c(t,{method:"post"})},G=a=>{a.preventDefault();const t=new FormData(a.currentTarget);t.append("_action",n),n==="update"&&l&&t.append("id",l.id),c(t,{method:"post"})},J=a=>{a.preventDefault();const t=new FormData(a.currentTarget);t.append("_action","link_student"),t.append("parent_id",M),c(t,{method:"post"})},D=[{accessorKey:"name",header:"Name",cell:({row:a})=>e.jsx("div",{className:"text-center",children:a.original.name})},{accessorKey:"email",header:"Email",cell:({row:a})=>e.jsx("div",{className:"text-center",children:a.original.email})},{id:"students",header:"Linked Students",cell:({row:a})=>{const t=a.original.id,b=E[t]||[];return e.jsxs("div",{className:"flex flex-wrap gap-1 justify-center",children:[b.length>0?b.map(h=>e.jsxs(De,{variant:"secondary",className:"flex items-center gap-1",children:[h.student_name,e.jsx("button",{className:"ml-1 text-xs hover:text-destructive",onClick:()=>U(h.id),children:"Ã—"})]},h.id)):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No students linked"}),e.jsx(s,{variant:"outline",size:"sm",onClick:()=>K(t),className:"mt-1 h-6",children:e.jsx(A,{className:"h-3 w-3"})})]})}},{accessorKey:"created_at",header:"Created At",cell:({row:a})=>e.jsx("div",{className:"text-center",children:new Date(a.original.created_at).toLocaleDateString()})},{id:"actions",header:"Actions",cell:({row:a})=>e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(s,{variant:"outline",size:"sm",onClick:()=>I(a.original),children:e.jsx(be,{className:"size-4"})}),e.jsx(s,{variant:"outline",size:"sm",onClick:()=>q(a.original),children:e.jsx(ve,{className:"size-4"})})]})}],r=ne({data:_,columns:D,getCoreRowModel:he(),getPaginationRowModel:ue(),initialState:{pagination:{pageSize:10}}}),Q=n==="create"?"Create New Parent":"Edit Parent";return e.jsxs("div",{className:"container mx-auto pb-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("span",{className:"ml-2 pt-2 text-xl font-semibold",children:"Manage Parents"}),e.jsxs(s,{onClick:H,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Add Parent"})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(xe,{children:[e.jsx(ge,{children:r.getHeaderGroups().map(a=>e.jsx(g,{children:a.headers.map(t=>e.jsx(je,{className:"text-center",children:!t.isPlaceholder&&y(t.column.columnDef.header,t.getContext())},t.id))},a.id))}),e.jsx(fe,{children:r.getRowModel().rows.length?r.getRowModel().rows.map(a=>e.jsx(g,{children:a.getVisibleCells().map(t=>e.jsx(T,{className:"text-center",children:y(t.column.columnDef.cell,t.getContext())},t.id))},a.id)):e.jsx(g,{children:e.jsx(T,{colSpan:D.length,className:"h-24 text-center",children:"No parents found."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(s,{variant:"outline",size:"sm",onClick:()=>r.previousPage(),disabled:!r.getCanPreviousPage(),children:"Previous"}),e.jsx(s,{variant:"outline",size:"sm",onClick:()=>r.nextPage(),disabled:!r.getCanNextPage(),children:"Next"})]}),e.jsx(N,{open:R,onOpenChange:d,children:e.jsxs(C,{children:[e.jsxs(w,{children:[e.jsx(S,{children:Q}),e.jsx(k,{children:n==="create"?"Fill out the form below to create a new parent account.":"Update the parent information."})]}),e.jsxs("form",{onSubmit:G,children:[e.jsxs("div",{className:"grid gap-4 pb-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"name",children:"Full Name"}),e.jsx(x,{id:"name",name:"name",placeholder:"Enter full name",defaultValue:(l==null?void 0:l.name)||"",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx(x,{id:"email",name:"email",type:"email",placeholder:"Enter email address",defaultValue:(l==null?void 0:l.email)||"",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"password",children:n==="create"?"Password":"New Password (leave blank to keep current)"}),e.jsx(x,{id:"password",name:"password",type:"password",placeholder:n==="create"?"Enter password":"Enter new password or leave blank",required:n==="create"})]})]}),e.jsxs(P,{children:[e.jsx(s,{variant:"outline",onClick:()=>d(!1),type:"button",children:"Cancel"}),e.jsx(s,{type:"submit",children:n==="create"?"Create Parent":"Update Parent"})]})]})]})}),e.jsx(le,{open:L,onOpenChange:u,children:e.jsxs(ie,{children:[e.jsxs(re,{className:"text-center",children:[e.jsx(oe,{children:"Delete Parent"}),e.jsxs(de,{children:['Are you sure you want to delete parent "',m==null?void 0:m.name,'"? This will also remove all student links for this parent. This action cannot be undone.']})]}),e.jsxs(ce,{className:"flex justify-end",children:[e.jsx(me,{children:"Cancel"}),e.jsx(pe,{onClick:V,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(N,{open:O,onOpenChange:p,children:e.jsxs(C,{children:[e.jsxs(w,{children:[e.jsx(S,{children:"Link Student"}),e.jsx(k,{children:"Select a student to link to this parent."})]}),e.jsxs("form",{onSubmit:J,children:[e.jsx("div",{className:"grid gap-4 pb-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"student_id",children:"Student"}),e.jsxs($,{name:"student_id",required:!0,children:[e.jsx(ee,{className:"w-full",children:e.jsx(ae,{placeholder:"Select a student"})}),e.jsx(te,{children:F.map(a=>e.jsxs(se,{value:a.id.toString(),children:[a.name," (",a.email,")"]},a.id))})]})]})}),e.jsxs(P,{children:[e.jsx(s,{variant:"outline",onClick:()=>p(!1),type:"button",children:"Cancel"}),e.jsx(s,{type:"submit",children:"Link Student"})]})]})]})})]})}export{Ve as default};
