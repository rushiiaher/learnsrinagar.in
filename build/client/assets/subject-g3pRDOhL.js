import{y as _,w as H,C as O,D as I,r as l,n as e}from"./components-CK9cG6NQ.js";import{t as D}from"./index-C8LQY8mX.js";import{B as n}from"./button-8oCJS-za.js";import{I as B}from"./input-BXDRLaNk.js";import{D as K,a as L,b as U,c as V,d as $,e as q}from"./dialog-B7fq2mTW.js";import{u as G,f as C,A as J,a as Q,b as W,c as X,d as Y,e as Z,g as ee,h as se,i as ae,j as te}from"./index-BpyxCKkI.js";import{C as le}from"./checkbox-T2i29Kah.js";import{T as ie,a as ne,b as j,c as ce,d as oe,e as S}from"./table-CRJQl8tI.js";import{P as re}from"./plus-BQN0Gcjy.js";import{P as de}from"./pencil-DYF0NOrj.js";import{T as me}from"./trash-sprkVQyV.js";import"./index-DPB-uZjz.js";import"./index-Z0unZZUp.js";import"./index-B5_uNIGj.js";import"./index-B4ME6Vf2.js";import"./x-DGchQd-t.js";import"./createLucideIcon-B7_wo53H.js";import"./index-B4BDNWcH.js";import"./index-USjovnYi.js";function Re(){const{subjects:N,classes:v}=_(),c=H(),p=O();I();const[y,o]=l.useState(!1),[r,g]=l.useState("create"),[t,b]=l.useState(null),[w,h]=l.useState(!1),[m,T]=l.useState(null),[u,x]=l.useState([]);l.useEffect(()=>{c&&(c.success?(D.success(c.message),o(!1)):D.error(c.message))},[c]),l.useEffect(()=>{t&&t.classes?x(t.classes.map(s=>s.id.toString())):x([])},[t]);const A=()=>{g("create"),b(null),x([]),o(!0)},P=s=>{g("update"),b(s),o(!0)},k=s=>{T(s),h(!0)},R=()=>{const s=new FormData;s.append("_action","delete"),s.append("id",m.id),p(s,{method:"post"}),h(!1)},E=s=>{x(a=>{const d=s.toString();return a.includes(d)?a.filter(M=>M!==d):[...a,d]})},z=s=>{s.preventDefault();const a=new FormData(s.currentTarget);a.append("_action",r),u.forEach(d=>{a.append("class_ids",d)}),r==="update"&&t&&a.append("id",t.id),p(a,{method:"post"})},f=[{accessorKey:"name",header:"Subject",cell:({row:s})=>e.jsx("div",{className:"text-center",children:s.original.name})},{accessorKey:"class_names",header:"Classes",cell:({row:s})=>e.jsx("div",{className:"text-center",children:s.original.class_names})},{accessorKey:"created_at",header:"Created At",cell:({row:s})=>e.jsx("div",{className:"text-center",children:new Date(s.original.created_at).toLocaleDateString()})},{id:"actions",header:"Actions",cell:({row:s})=>e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>P(s.original),children:e.jsx(de,{className:"size-4"})}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>k(s.original),children:e.jsx(me,{className:"size-4"})})]})}],i=G({data:N,columns:f,getCoreRowModel:te(),getPaginationRowModel:ae(),initialState:{pagination:{pageSize:10}}}),F=r==="create"?"Create New Subject":"Edit Subject";return e.jsxs("div",{className:"container mx-auto pb-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("span",{className:"ml-2 pt-2 text-xl font-semibold",children:"Manage Subjects"}),e.jsxs(n,{onClick:A,children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Add Subject"})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ie,{children:[e.jsx(ne,{children:i.getHeaderGroups().map(s=>e.jsx(j,{children:s.headers.map(a=>e.jsx(ce,{className:"text-center",children:a.isPlaceholder?null:C(a.column.columnDef.header,a.getContext())},a.id))},s.id))}),e.jsx(oe,{children:i.getRowModel().rows.length?i.getRowModel().rows.map(s=>e.jsx(j,{"data-state":s.getIsSelected()&&"selected",children:s.getVisibleCells().map(a=>e.jsx(S,{className:"text-center",children:C(a.column.columnDef.cell,a.getContext())},a.id))},s.id)):e.jsx(j,{children:e.jsx(S,{colSpan:f.length,className:"h-24 text-center",children:"No subjects found."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>i.previousPage(),disabled:!i.getCanPreviousPage(),children:"Previous"}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>i.nextPage(),disabled:!i.getCanNextPage(),children:"Next"})]}),e.jsx(K,{open:y,onOpenChange:o,children:e.jsxs(L,{children:[e.jsxs(U,{children:[e.jsx(V,{children:F}),e.jsx($,{children:r==="create"?"Fill out the form below to create a new subject.":"Update the subject information."})]}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"grid gap-4 pb-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"name",children:"Subject Name"}),e.jsx(B,{id:"name",name:"name",placeholder:"Enter subject name",defaultValue:(t==null?void 0:t.name)||"",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{children:"Classes"}),e.jsx("div",{className:"border rounded-md p-4 max-h-60 overflow-y-auto",children:e.jsx("div",{className:"space-y-2",children:v.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{id:`class-${s.id}`,checked:u.includes(s.id.toString()),onCheckedChange:()=>E(s.id)}),e.jsxs("label",{htmlFor:`class-${s.id}`,className:"text-sm cursor-pointer",children:["Class ",s.name]})]},s.id))})}),u.length===0&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Please select at least one class."})]})]}),e.jsxs(q,{children:[e.jsx(n,{variant:"outline",onClick:()=>o(!1),type:"button",children:"Cancel"}),e.jsx(n,{type:"submit",disabled:u.length===0,children:r==="create"?"Create Subject":"Update Subject"})]})]})]})}),e.jsx(J,{open:w,onOpenChange:h,children:e.jsxs(Q,{children:[e.jsxs(W,{className:"text-center",children:[e.jsx(X,{children:"Delete Subject"}),e.jsxs(Y,{children:['Are you sure you want to delete subject "',m==null?void 0:m.name,'"? This action cannot be undone.']})]}),e.jsxs(Z,{className:"flex justify-end",children:[e.jsx(ee,{children:"Cancel"}),e.jsx(se,{onClick:R,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})})]})}export{Re as default};
