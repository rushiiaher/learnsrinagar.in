import{y as ee,w as ae,C as se,D as te,r as n,n as e}from"./components-CK9cG6NQ.js";import{t as E}from"./index-C8LQY8mX.js";import{B as r}from"./button-8oCJS-za.js";import{I as d}from"./input-BXDRLaNk.js";import{P as le,a as ne,C as re,b as ie,c as de}from"./popover-x_GHSun8.js";import{S as T,a as A,b as R,c as q,d as M}from"./select-DaRfL70x.js";import{D as oe,a as ce,b as me,c as pe,d as xe,e as he}from"./dialog-B7fq2mTW.js";import{u as ue,f as z,A as ge,a as je,b as fe,c as Ne,d as be,e as ve,g as _e,h as Ce,i as De,j as we}from"./index-BpyxCKkI.js";import{T as ye,a as Pe,b as v,c as Se,d as ke,e as B}from"./table-CRJQl8tI.js";import{B as L}from"./badge-CcGIdf3j.js";import{C as V}from"./checkbox-T2i29Kah.js";import{P as Fe}from"./plus-BQN0Gcjy.js";import{P as Ee}from"./pencil-DYF0NOrj.js";import{T as Te}from"./trash-sprkVQyV.js";import{f as H}from"./format-CkqhGn1q.js";import"./createLucideIcon-B7_wo53H.js";import"./chevron-right-6IEetazl.js";import"./index-Z0unZZUp.js";import"./index-B5_uNIGj.js";import"./index-DHMePj9W.js";import"./index-USjovnYi.js";import"./index-B4ME6Vf2.js";import"./index-B4BDNWcH.js";import"./index-DPB-uZjz.js";import"./x-DGchQd-t.js";function ia(){var S,k;const{students:K,classes:_,schools:Ae,user:Re,parents:O,studentParentLinks:C}=ee(),o=ae(),g=se();te();const[I,m]=n.useState(!1),[l,D]=n.useState("create"),[s,w]=n.useState(null),[U,j]=n.useState(!1),[h,$]=n.useState(null),[c,u]=n.useState(null),[G,qe]=n.useState({pageIndex:0,pageSize:10}),[p,f]=n.useState(!1),[x,N]=n.useState(!1);n.useEffect(()=>{o&&(o.success?E.success(o.message):E.error(o.message),o.success&&m(!1))},[o]),n.useEffect(()=>{s!=null&&s.date_of_birth?u(new Date(s.date_of_birth)):u(null),f(!1),N(!1)},[s]);const J=()=>{D("create"),w(null),u(null),m(!0),f(!1),N(!1)},Q=a=>{D("update"),w(a),m(!0)},W=a=>{$(a),j(!0)},X=()=>{const a=new FormData;a.append("_action","delete"),a.append("id",h.id),g(a,{method:"post"}),j(!1)},y=a=>{const t=new FormData;t.append("_action","remove_parent_link"),t.append("link_id",a),g(t,{method:"post"})},Y=a=>{a.preventDefault();const t=new FormData(a.currentTarget);t.append("_action",l),l==="update"&&s&&(t.append("id",s.id),s.profile_id&&t.append("profile_id",s.profile_id)),c&&t.set("date_of_birth",H(c,"yyyy-MM-dd")),g(t,{method:"post"})},P=[{accessorKey:"name",header:"Name",cell:({row:a})=>e.jsx("div",{className:"text-center",children:a.original.name})},{accessorKey:"email",header:"Email",cell:({row:a})=>e.jsx("div",{className:"text-center",children:a.original.email})},{accessorKey:"enrollment_no",header:"Enrollment No",cell:({row:a})=>e.jsx("div",{className:"text-center",children:a.original.enrollment_no||"-"})},{accessorKey:"class_name",header:"Class",cell:({row:a})=>e.jsx("div",{className:"text-center",children:a.original.class_name||"-"})},{id:"parents",header:"Linked Parents",cell:({row:a})=>{const t=a.original.id,F=C[t]||[];return e.jsx("div",{className:"flex flex-wrap gap-1 justify-center",children:F.length>0?F.map(b=>e.jsxs(L,{variant:"secondary",className:"flex items-center gap-1",children:[b.parent_name,e.jsx("button",{className:"ml-1 text-xs hover:text-destructive",onClick:()=>y(b.id),children:"×"})]},b.id)):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No parents linked"})})}},{accessorKey:"date_of_birth",header:"Date of Birth",cell:({row:a})=>e.jsx("div",{className:"text-center",children:a.original.date_of_birth?new Date(a.original.date_of_birth).toLocaleDateString():"-"})},{id:"actions",header:"Actions",cell:({row:a})=>e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>Q(a.original),children:e.jsx(Ee,{className:"size-4"})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>W(a.original),children:e.jsx(Te,{className:"size-4"})})]})}],i=ue({data:K,columns:P,getCoreRowModel:we(),getPaginationRowModel:De(),initialState:{pagination:G}}),Z=l==="create"?"Create New Student":"Edit Student";return e.jsxs("div",{className:"container mx-auto pb-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("span",{className:"ml-2 pt-2 text-xl font-semibold",children:"Manage Students"}),e.jsxs(r,{onClick:J,children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Add Student"})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ye,{children:[e.jsx(Pe,{children:i.getHeaderGroups().map(a=>e.jsx(v,{children:a.headers.map(t=>e.jsx(Se,{className:"text-center",children:t.isPlaceholder?null:z(t.column.columnDef.header,t.getContext())},t.id))},a.id))}),e.jsx(ke,{children:i.getRowModel().rows.length?i.getRowModel().rows.map(a=>e.jsx(v,{children:a.getVisibleCells().map(t=>e.jsx(B,{className:"text-center",children:z(t.column.columnDef.cell,t.getContext())},t.id))},a.id)):e.jsx(v,{children:e.jsx(B,{colSpan:P.length,className:"h-24 text-center",children:"No students found."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>i.previousPage(),disabled:!i.getCanPreviousPage(),children:"Previous"}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>i.nextPage(),disabled:!i.getCanNextPage(),children:"Next"})]}),e.jsx(oe,{open:I,onOpenChange:m,children:e.jsxs(ce,{className:"max-w-3xl",children:[e.jsxs(me,{children:[e.jsx(pe,{children:Z}),e.jsx(xe,{children:l==="create"?"Fill out the form below to create a new student account.":"Update the student information."})]}),e.jsxs("form",{onSubmit:Y,children:[e.jsxs("div",{className:"grid gap-6 pb-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"name",children:"Name"}),e.jsx(d,{id:"name",name:"name",placeholder:"Enter full name",defaultValue:(s==null?void 0:s.name)||"",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx(d,{id:"email",name:"email",type:"email",placeholder:"Enter email address",defaultValue:(s==null?void 0:s.email)||"",required:!0})]}),e.jsxs("div",{className:"grid gap-2 col-span-2",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx(d,{id:"password",name:"password",type:"password",placeholder:l==="create"?"Enter password":"leave blank to keep current",required:l==="create"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"enrollment_no",children:"Enrollment Number"}),e.jsx(d,{id:"enrollment_no",name:"enrollment_no",type:"number",placeholder:"Enter enrollment number",defaultValue:(s==null?void 0:s.enrollment_no)||"",required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"date_of_birth",children:"Date of Birth"}),e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(r,{variant:"outline",className:`w-full justify-start text-left font-normal ${!c&&"text-muted-foreground"}`,children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),c?H(c,"PPP"):"Select date"]})}),e.jsx(ie,{className:"w-auto p-0",children:e.jsx(de,{mode:"single",selected:c,onSelect:u,initialFocus:!0})})]})]}),_.length>0?e.jsxs("div",{className:"grid gap-2 col-span-2",children:[e.jsx("label",{htmlFor:"class_id",children:"Class"}),e.jsxs(T,{name:"class_id",defaultValue:((S=s==null?void 0:s.class_id)==null?void 0:S.toString())||"",required:!0,children:[e.jsx(A,{className:"w-full",children:e.jsx(R,{placeholder:"Select a class"})}),e.jsx(q,{children:_.map(a=>e.jsxs(M,{value:a.id.toString(),children:["Class ",a.name]},a.id))})]})]}):e.jsxs("div",{className:"grid gap-2 col-span-2",children:[e.jsx("label",{htmlFor:"class_id",children:"Class"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No classes available for your account."}),e.jsx("input",{type:"hidden",name:"class_id",value:(s==null?void 0:s.class_id)||""})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(V,{id:"add_parent",name:"add_parent",checked:p,onCheckedChange:f}),e.jsx("label",{htmlFor:"add_parent",className:"text-base font-medium",children:l==="create"?"Add parent information":"Link or add a new parent"})]}),p&&e.jsxs(e.Fragment,{children:[l==="update"&&s&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Current linked parents:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:((k=C[s.id])==null?void 0:k.map(a=>e.jsxs(L,{variant:"secondary",className:"flex items-center gap-1",children:[a.parent_name," (",a.parent_email,")",e.jsx("button",{className:"ml-1 text-xs hover:text-destructive",type:"button",onClick:()=>y(a.id),children:"×"})]},a.id)))||e.jsx("span",{className:"text-muted-foreground",children:"No parents linked"})})]})}),e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(V,{id:"use_existing_parent",checked:x,onCheckedChange:N}),e.jsx("label",{htmlFor:"use_existing_parent",className:"text-sm font-medium",children:"Use existing parent"})]}),x?e.jsxs("div",{className:"grid gap-2 mb-4",children:[e.jsx("label",{htmlFor:"existing_parent_id",children:"Select Parent"}),e.jsxs(T,{name:"existing_parent_id",required:!0,children:[e.jsx(A,{className:"w-full",children:e.jsx(R,{placeholder:"Select a parent"})}),e.jsx(q,{children:O.map(a=>e.jsxs(M,{value:a.id.toString(),children:[a.name," (",a.email,")"]},a.id))})]})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"parent_name",children:"Parent Name"}),e.jsx(d,{id:"parent_name",name:"parent_name",placeholder:"Enter parent full name",required:p&&!x})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"parent_email",children:"Parent Email"}),e.jsx(d,{id:"parent_email",name:"parent_email",type:"email",placeholder:"Enter parent email address",required:p&&!x})]}),e.jsxs("div",{className:"grid gap-2 col-span-2",children:[e.jsx("label",{htmlFor:"parent_password",children:"Parent Password"}),e.jsx(d,{id:"parent_password",name:"parent_password",type:"password",placeholder:l==="create"?"Enter parent password":"Leave blank to set default password",required:l==="create"&&p&&!x})]})]})]})]})]}),e.jsxs(he,{className:"mt-4",children:[e.jsx(r,{variant:"outline",onClick:()=>m(!1),type:"button",children:"Cancel"}),e.jsx(r,{type:"submit",children:l==="create"?"Create Student":"Update Student"})]})]})]})}),e.jsx(ge,{open:U,onOpenChange:j,children:e.jsxs(je,{children:[e.jsxs(fe,{className:"text-center",children:[e.jsx(Ne,{children:"Delete Student"}),e.jsxs(be,{children:['Are you sure you want to delete student "',h==null?void 0:h.name,'"? This will also remove all parent links for this student. This action cannot be undone.']})]}),e.jsxs(ve,{className:"flex justify-end",children:[e.jsx(_e,{children:"Cancel"}),e.jsx(Ce,{onClick:X,className:"bg-destructive hover:bg-destructive/90",children:"Delete"})]})]})})]})}export{ia as default};
