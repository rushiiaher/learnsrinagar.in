import{y as $,r as d,n as s}from"./components-CK9cG6NQ.js";import{S as E,a as I,b as A,c as V,d as T}from"./select-DaRfL70x.js";import{I as q}from"./input-BXDRLaNk.js";import"./button-8oCJS-za.js";import{c as L}from"./createLucideIcon-B7_wo53H.js";import{f as m,i as J}from"./format-CkqhGn1q.js";import"./index-Z0unZZUp.js";import"./index-B5_uNIGj.js";import"./index-DHMePj9W.js";import"./index-USjovnYi.js";import"./index-B4BDNWcH.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],U=L("video",K);function X(){const{liveClasses:y,user:c}=$(),[o,w]=d.useState(m(new Date,"yyyy-MM-dd")),[g,N]=d.useState([]),[j,v]=d.useState([]),[b,S]=d.useState([]),[x,D]=d.useState("all"),[C,M]=d.useState({}),h=c&&c.role_name==="teacher",k=c&&["super_admin","school_admin","class_admin","teacher"].includes(c.role_name);return d.useEffect(()=>{const r=new Date(o);let i=y.filter(e=>{const t=new Date(e.class_date);return J(t,r)});if(c&&c.class_ids){const e=Array.isArray(c.class_ids)?c.class_ids:c.class_ids.split(",").map(t=>parseInt(t.trim()));e.length!==0&&(i=i.filter(t=>e.includes(t.class_id)))}if(h&&(i=i.filter(e=>e.teacher_id===c.id)),x!=="all"&&(i=i.filter(e=>e.teacher_id.toString()===x)),i.sort((e,t)=>{const a=new Date(`2000-01-01T${e.class_time}`).getTime(),n=new Date(`2000-01-01T${t.class_time}`).getTime();return a-n}),!h){const e=[],t=new Map;y.forEach(a=>{t.has(a.teacher_id)||(t.set(a.teacher_id,{id:a.teacher_id,name:a.teacher_name}),e.push({id:a.teacher_id,name:a.teacher_name}))}),e.sort((a,n)=>a.name.localeCompare(n.name)),S(e)}const l=[],u=new Map;i.forEach(e=>{const t=new Date(`2000-01-01T${e.class_time}`),a=new Date(t.getTime()+e.duration_minutes*6e4),n=`${m(t,"h:mm")} - ${m(a,"h:mm")}`;u.has(n)||(u.set(n,{key:n,startTime:t,endTime:a,formattedTime:n}),l.push({key:n,startTime:t,endTime:a,formattedTime:n}))}),l.sort((e,t)=>e.startTime.getTime()-t.startTime.getTime()),N(l);const f=[],_=new Map;i.forEach(e=>{_.has(e.class_id)||(_.set(e.class_id,{id:e.class_id,name:e.class_name}),f.push({id:e.class_id,name:e.class_name}))}),f.sort((e,t)=>e.name.localeCompare(t.name)),v(f);const p={};f.forEach(e=>{p[e.id]={},l.forEach(t=>{p[e.id][t.key]=null})}),i.forEach(e=>{const t=new Date(`2000-01-01T${e.class_time}`),a=new Date(t.getTime()+e.duration_minutes*6e4),n=`${m(t,"h:mm")} - ${m(a,"h:mm")}`;p[e.class_id][n]={id:e.id,subject:e.subject_name,teacher:e.teacher_name,startTime:t,endTime:a,joinUrl:e.join_url,description:e.description}}),M(p)},[y,o,c,h,x]),s.jsxs("div",{className:"container mx-auto pb-10",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("h1",{className:"ml-2 pt-2 text-xl font-semibold",children:"Class Schedule"})}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(q,{type:"date",value:o,onChange:r=>w(r.target.value),className:"w-full sm:w-[200px]"})}),!h&&b.length>0&&s.jsxs(E,{value:x,onValueChange:r=>D(r),children:[s.jsx(I,{className:"w-full sm:w-[240px]",children:s.jsx(A,{placeholder:"Filter by Teacher"})}),s.jsxs(V,{children:[s.jsx(T,{value:"all",children:"All Teachers"}),b.map(r=>s.jsx(T,{value:r.id.toString(),children:r.name},r.id))]})]})]})]}),s.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:s.jsxs("span",{className:"font-medium text-gray-700",children:["Showing schedule for: ",m(new Date(o),"dd/MM/yyyy")]})}),g.length>0&&j.length>0?s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"border border-gray-300 bg-gray-100 p-2 text-center font-medium text-sm",children:"Class"}),g.map(r=>s.jsx("th",{className:"border border-gray-300 bg-gray-100 p-2 text-center font-medium text-sm",children:r.formattedTime},r.key))]})}),s.jsx("tbody",{children:j.map(r=>s.jsxs("tr",{children:[s.jsxs("td",{className:"border border-gray-300 bg-gray-50 p-3 text-center font-medium",children:["Class ",r.name]}),g.map(i=>{var u;const l=(u=C[r.id])==null?void 0:u[i.key];return l?s.jsxs("td",{className:"border border-gray-300 p-4 text-center",children:[s.jsx("div",{className:"font-medium",children:l.subject}),s.jsxs("div",{className:"text-sm mt-1",children:["(",l.teacher,")"]}),l.description&&s.jsx("div",{className:"text-xs text-gray-600 mt-1 italic",children:l.description}),k&&s.jsx("div",{className:"mt-3",children:s.jsxs("a",{href:l.joinUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center rounded-md bg-primary px-3 py-1.5 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring",children:[s.jsx(U,{className:"h-3.5 w-3.5 mr-1.5"}),"Join Class"]})})]},i.key):s.jsx("td",{className:"border border-gray-300 p-4 text-center text-gray-400",children:"-"},i.key)})]},r.id))})]})}):s.jsx("div",{className:"p-8 text-center text-muted-foreground border rounded-lg",children:h?`You have no classes scheduled for ${m(new Date(o),"dd/MM/yyyy")}.`:`No classes scheduled for ${m(new Date(o),"dd/MM/yyyy")}.`})]})}export{X as default};
